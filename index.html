<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="google" value="notranslate">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>抖音直播间</title>
<!-- 修复：更换为可用的Tailwind CDN（3.3.2版本，国内稳定访问） -->
<script src="https://cdn.bootcdn.net/ajax/libs/tailwindcss/3.3.2/tailwind.min.js"></script>
<link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/layui/2.9.6/css/layui.css">
<script src="https://cdn.bootcdn.net/ajax/libs/layui/2.9.6/layui.js"></script>
<style type="text/css">
@charset "utf-8";
/* 修复1：强化页面全屏样式，兼容更多浏览器 */
* {
    margin: 0; 
    padding: 0;
    touch-action: auto;
    box-sizing: border-box; /* 新增：确保盒模型计算正确 */
}
html, body {
    width: 100vw; /* 改用视口单位 */
    height: 100vh;
    overflow: hidden;
    padding: 0;
    margin: 0;
}
.app{
    width: 100vw; 
    height: 100vh; 
    position: fixed; /* 改用fixed定位，避免滚动偏移 */
    top: 0;
    left: 0;
    overflow: hidden;
    background-color: #000;
}
#player{
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center center;
    z-index: 10;
}
video::-internal-media-controls-download-button { display: none; }
video::-webkit-media-controls-enclosure { overflow: hidden; }
video::-webkit-media-controls-panel { width: calc(100% + 30px); }

/* 评论区样式 */
.comments-container {
    position: absolute;
    bottom: 130px;
    left: 0;
    width: 85%;
    height: 25vh;
    z-index: 20;
    overflow: hidden;
    pointer-events: none;
    padding-left: 10px;
    box-sizing: border-box;
}

.comments-wrapper {
    position: absolute;
    width: 100%;
    bottom: 0;
}

.comment {
    width: fit-content;
    max-width: 90%;
    padding: 8px 14px;
    margin-bottom: 6px;
    margin-left: 5px;
    border-radius: 20px;
    background-color: rgba(0, 0, 0, 0.3);
    color: white;
    text-align: left;
    font-size: 14px;
    line-height: 1.4;
    opacity: 0;
    transform: translateY(15px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    word-wrap: break-word;
    white-space: normal;
}

.comment.active {
    opacity: 1;
    transform: translateY(0);
}

.comment.exit {
    opacity: 0;
    transform: translateY(-15px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
}

.comment .username {
    font-weight: 500;
    margin-right: 8px;
}

/* 等级图标样式 */
.level-icon {
    display: inline-block;
    margin-right: 5px;
    font-size: 12px;
}

/* 广告栏样式 */
.ad-banner {
    position: absolute;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    min-height: 60px;
    max-height: 200px;
    z-index: 100;
    border-radius: 10px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    pointer-events: auto !important;
    box-sizing: border-box;
}

/* 广告容器 - 直接嵌入无需JS */
.ad-content {
    width: 100%;
    height: 100%;
}
.ad-placement-banner-1 {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}
.ad-placement-banner-1 img {
    max-width: 100% !important;
    max-height: 180px !important;
    object-fit: contain !important;
    border-radius: 5px;
}

.close-ad {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    font-size: 12px;
    cursor: pointer;
    z-index: 101;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* 修复2：确保底部发送窗口在所有浏览器可见 */
.interaction-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background: linear-gradient(180deg, transparent, rgba(0,0,0,0.7));
    z-index: 25;
    display: flex;
    align-items: center;
    padding: 0 15px;
    box-sizing: border-box;
    /* 新增：防止被浏览器底部导航栏遮挡 */
    padding-bottom: constant(safe-area-inset-bottom);
    padding-bottom: env(safe-area-inset-bottom);
}

.danmaku-input {
    flex: 1;
    height: 36px;
    background-color: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 18px;
    padding: 0 15px;
    color: #fff;
    font-size: 14px;
    text-align: left;
}

.send-btn {
    width: 60px;
    height: 36px;
    background-color: #FE2C55;
    color: #fff;
    border: none;
    border-radius: 18px;
    font-size: 14px;
    font-weight: 500;
    margin-left: 10px;
}

/* 视频信息提示 */
.video-info {
    position: absolute;
    top: 20px;
    left: 15px;
    background-color: rgba(0,0,0,0.5);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 20;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

/* 滑动提示 */
.swipe-hint {
    position: absolute;
    top: 50%;
    left: 10px;
    color: rgba(255,255,255,0.7);
    font-size: 14px;
    z-index: 20;
    transform: translateY(-50%);
    background-color: rgba(0,0,0,0.3);
    padding: 5px 10px;
    border-radius: 20px;
}
</style>
</head>
<body>
    <div class="app" ontouchmove="return false;">
        <!-- 视频播放器 -->
        <video id="player" 
               src="https://tucdn.wpon.cn/api-girl/videos/76.mp4" 
               autoplay preload 
               webkit-playsinline='true' playsinline='true' 
               x5-video-player-type='h5' 
               x5-video-player-fullscreen='true' 
               x5-video-ignore-metadata='true' 
               poster="https://gd-hbimg.huaban.com/dd5c3c7f9ab5aa97ff3b84852f834f47873bd2a5fee0-tBa7jJ_fw658webp">
        </video>
        
        <!-- 滑动提示 -->
        <div class="swipe-hint">
            <i class="fa fa-exchange"></i> 左右滑动切换直播
        </div>
        
        <!-- 视频信息提示 -->
        <div class="video-info">
            <i class="fa fa-info-circle"></i> 视频加载中，若无法播放请刷新页面
        </div>
        
        <!-- 评论区 -->
        <div class="comments-container" id="commentsContainer">
            <div class="comments-wrapper" id="commentsWrapper"></div>
        </div>
        
        <!-- 广告栏 -->
        <div class="ad-banner" id="adBanner">
            <div class="ad-content">
                <div class="ad-placement-banner-1"></div>
                <script src="https://adsc.144514.xyz/ad/embed?placement=banner-1"></script>
            </div>
            <button class="close-ad" id="closeAd">×</button>
        </div>
        
        <!-- 底部互动区 -->
        <div class="interaction-bar">
            <input type="text" class="danmaku-input" placeholder="发送弹幕...">
            <button class="send-btn">发送</button>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    $(document).ready(function(){
        layer.msg('加载环境中，请稍候！');
        let auto = false; 
        let textstf = false;
        let gi = 1;
        let gi_max = 1;
        let vdnum = 0;
        const url = "./get-random-url"; // 视频接口地址
        let vdurlold = new Array("https://tucdn.wpon.cn/api-girl/videos/76.mp4");
        let vdurl_arr = new Array(
            "https://tucdn.wpon.cn/api-girl/videos/76.mp4",
            "https://tucdn.wpon.cn/api-girl/videos/68.mp4",
            "https://tucdn.wpon.cn/api-girl/videos/54.mp4",
            "https://tucdn.wpon.cn/api-girl/videos/42.mp4",
            "https://tucdn.wpon.cn/api-girl/videos/36.mp4"
        );
        
        let currentVideoIndex = 0;
        let startX = 0;
        let endX = 0;
        const swipeThreshold = 50;
        const commentsContainer = document.getElementById('commentsContainer');
        const adBanner = document.getElementById('adBanner');
        const player = document.getElementById('player');
        
        // 接口处理：直接返回URL字符串
        function getRandomVideoFromApi() {
            return new Promise((resolve, reject) => {
                $.get(url)
                    .done(function(videoUrl) {
                        if (videoUrl && videoUrl.trim()) {
                            if (vdurlold.includes(videoUrl.trim())) {
                                getRandomVideoFromApi().then(resolve).catch(reject);
                            } else {
                                resolve(videoUrl.trim());
                            }
                        } else {
                            reject(new Error('接口返回空地址'));
                        }
                    })
                    .fail(function(xhr, status, err) {
                        reject(new Error(`接口请求失败: ${status}`));
                    });
            });
        }
        
        // 视频播放逻辑
        player.addEventListener('ended', function() {
            if (auto) {
                this.currentTime = 0;
                this.play();
            } else {
                getRandomVideoFromApi()
                    .then(newUrl => {
                        vdurl_arr.push(newUrl);
                        currentVideoIndex = vdurl_arr.length - 1;
                        changeVideo(currentVideoIndex);
                    })
                    .catch(err => {
                        console.log('接口获取视频失败，使用本地数组', err);
                        let nextIndex = (currentVideoIndex + 1) % vdurl_arr.length;
                        while (vdurlold.includes(vdurl_arr[nextIndex]) && vdurl_arr.length > 1) {
                            nextIndex = (nextIndex + 1) % vdurl_arr.length;
                        }
                        currentVideoIndex = nextIndex;
                        changeVideo(currentVideoIndex);
                    });
            }
        });
        
        // 滑动切换视频逻辑
        document.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
        }, false);
        
        document.addEventListener('touchend', function(e) {
            endX = e.changedTouches[0].clientX;
            handleSwipe();
        }, false);
        
        function handleSwipe() {
            const diffX = startX - endX;
            if (diffX < -swipeThreshold) { // 向右滑动（上一个）
                currentVideoIndex = (currentVideoIndex - 1 + vdurl_arr.length) % vdurl_arr.length;
                changeVideo(currentVideoIndex);
            } else if (diffX > swipeThreshold) { // 向左滑动（下一个）
                getRandomVideoFromApi()
                    .then(newUrl => {
                        vdurl_arr.push(newUrl);
                        currentVideoIndex = vdurl_arr.length - 1;
                        changeVideo(currentVideoIndex);
                    })
                    .catch(err => {
                        console.log('接口获取视频失败，使用本地数组', err);
                        let nextIndex = (currentVideoIndex + 1) % vdurl_arr.length;
                        while (vdurlold.includes(vdurl_arr[nextIndex]) && vdurl_arr.length > 1) {
                            nextIndex = (nextIndex + 1) % vdurl_arr.length;
                        }
                        currentVideoIndex = nextIndex;
                        changeVideo(currentVideoIndex);
                    });
            }
        }
        
        // 切换视频函数
        function changeVideo(index) {
            player.pause();
            layer.msg('切换视频中...');
            document.querySelector('.video-info').innerHTML = '<i class="fa fa-spinner fa-spin"></i> 切换视频中...';
            
            vdnum = index;
            if (vdurl_arr.length > 0 && index >= 0 && index < vdurl_arr.length) {
                const videoUrl = vdurl_arr[index];
                player.src = videoUrl;
                
                if (!vdurlold.includes(videoUrl)) {
                    vdurlold.push(videoUrl);
                }
                
                player.load();
                player.play().then(() => {
                    document.querySelector('.video-info').innerHTML = '<i class="fa fa-info-circle"></i> 视频加载中，若无法播放请刷新页面';
                    commentsWrapper.innerHTML = '';
                    for (let i = 0; i < 4; i++) {
                        setTimeout(() => addComment(), i * 400);
                    }
                }).catch(err => {
                    console.error('视频切换失败:', err);
                    layer.msg('视频切换失败，请重试');
                    document.querySelector('.video-info').innerHTML = '<i class="fa fa-exclamation-triangle"></i> 视频切换失败，请重试';
                });
            }
        }
        
        // 评论区相关逻辑
        function generatePhoneNumber() {
            const prefix = ['130', '131', '132', '133', '134', '135', '136', '137', '138', '139', '150', '151', '152', '153', '155', '156', '157', '158', '159', '170', '171', '173', '176', '177', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189'];
            const randomPrefix = prefix[Math.floor(Math.random() * prefix.length)];
            const lastFour = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            return `${randomPrefix}****${lastFour}`;
        }
        
        function generateLetterName() {
            const letters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let name = '';
            const prefixLength = 3 + Math.floor(Math.random() * 3);
            for (let i = 0; i < prefixLength; i++) {
                name += letters.charAt(Math.floor(Math.random() * letters.length));
            }
            name += '***';
            const suffixLength = 2 + Math.floor(Math.random() * 3);
            for (let i = 0; i < suffixLength; i++) {
                name += letters.charAt(Math.floor(Math.random() * letters.length));
            }
            return name;
        }
        
        function generateUsername() {
            return Math.random() > 0.5 ? generatePhoneNumber() : generateLetterName();
        }
        
        const levelIcons = [
            { icon: 'fa-diamond', color: '#FFD700' },
            { icon: 'fa-crown', color: '#FFA500' },
            { icon: 'fa-star', color: '#FFFF00' },
            { icon: 'fa-moon-o', color: '#87CEFA' },
            { icon: 'fa-sun-o', color: '#FF6347' },
            { icon: 'fa-shield', color: '#32CD32' },
            { icon: 'fa-heart', color: '#FF69B4' },
            { icon: 'fa-trophy', color: '#CD7F32' }
        ];
        
        function getRandomLevelIcon() {
            const level = levelIcons[Math.floor(Math.random() * levelIcons.length)];
            return `<i class="fa ${level.icon} level-icon" style="color: ${level.color}"></i>`;
        }
        
        const commentsContent = [
            "这个主播太有意思了",
            "刚来，这是在聊什么呀？",
            "前排围观",
            "主播声音好好听",
            "支持支持！",
            "哈哈哈太搞笑了",
            "下班刚到家就来看直播了",
            "有没有同款手机壳？",
            "看起来好好吃的样子",
            "这个地方我去过！真的很不错"
        ];
        
        function generateRandomComment() {
            return {
                username: generateUsername(),
                content: commentsContent[Math.floor(Math.random() * commentsContent.length)]
            };
        }

        const commentsWrapper = document.getElementById('commentsWrapper');
        
        function addComment() {
            const comment = generateRandomComment();
            const levelIcon = getRandomLevelIcon();
            
            const commentEl = document.createElement('div');
            commentEl.className = 'comment';
            commentEl.innerHTML = `${levelIcon}<span class="username">${comment.username}</span>${comment.content}`;
            
            commentsWrapper.appendChild(commentEl);
            
            setTimeout(() => {
                commentEl.classList.add('active');
            }, 50);
            
            const allComments = commentsWrapper.querySelectorAll('.comment');
            if (allComments.length > 4) {
                const oldestComment = allComments[0];
                oldestComment.classList.remove('active');
                oldestComment.classList.add('exit');
                
                setTimeout(() => {
                    if (oldestComment.parentNode === commentsWrapper) {
                        commentsWrapper.removeChild(oldestComment);
                    }
                }, 800);
            }
        }
        
        function scheduleNextComment() {
            const randomDelay = 1000 + Math.random() * 2000;
            setTimeout(() => {
                addComment();
                scheduleNextComment();
            }, randomDelay);
        }
        
        for (let i = 0; i < 4; i++) {
            setTimeout(() => addComment(), i * 600);
        }
        scheduleNextComment();
        
        // 发送弹幕功能
        const sendBtn = document.querySelector('.send-btn');
        const danmakuInput = document.querySelector('.danmaku-input');
        
        sendBtn.addEventListener('click', function() {
            const text = danmakuInput.value.trim();
            if (text) {
                const commentEl = document.createElement('div');
                commentEl.className = 'comment';
                commentEl.innerHTML = `<i class="fa fa-user level-icon" style="color: #FFFFFF"></i><span class="username">我</span>${text}`;
                
                commentsWrapper.appendChild(commentEl);
                setTimeout(() => {
                    commentEl.classList.add('active');
                }, 50);
                
                const allComments = commentsWrapper.querySelectorAll('.comment');
                if (allComments.length > 4) {
                    const oldestComment = allComments[0];
                    oldestComment.classList.remove('active');
                    oldestComment.classList.add('exit');
                    
                    setTimeout(() => {
                        commentsWrapper.removeChild(oldestComment);
                    }, 800);
                }
                
                danmakuInput.value = '';
            }
        });
        
        danmakuInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                sendBtn.click();
            }
        });
        
        // 关闭广告
        document.getElementById('closeAd').addEventListener('click', function() {
            adBanner.style.display = 'none';
            commentsContainer.style.bottom = '60px';
        });
        
        // 视频播放/暂停控制
        player.addEventListener('click', function() {
            if (this.paused) {
                this.play();
            } else {
                this.pause();
            }
        });
    });
    </script>
</body>
</html>
    
