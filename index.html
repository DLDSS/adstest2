<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="google" value="notranslate">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>抖音直播间</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/layui/2.9.6/css/layui.css">
<script src="https://cdn.bootcdn.net/ajax/libs/layui/2.9.6/layui.js"></script>
<link rel="preload" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2?v=4.7.0" as="font" type="font/woff2" crossorigin>
<style type="text/css">
@charset "utf-8";
*{
    margin: 0; 
    padding: 0;
    touch-action: pan-y;
}
.app{
    width: 100vw; 
    height: 100vh; 
    position: absolute;
    margin: 0;
    overflow: hidden;
    background-color: #000;
}
#player{
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center center;
    z-index: 10;
    background-color: #000;
    display: none;
}

/* 视频加载前的占位图 */
#video-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #000;
    background-image: url("https://gd-hbimg.huaban.com/dd5c3c7f9ab5aa97ff3b84852f834f47873bd2a5fee0-tBa7jJ_fw658webp");
    background-size: cover;
    background-position: center;
    z-index: 9;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
}

/* 视频覆盖层 - 用于点击播放/暂停 */
#video-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 15;
    background: transparent;
    pointer-events: auto;
}

/* 播放按钮 */
#play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70px;
    height: 70px;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 30px;
    z-index: 16;
    opacity: 0;
    transition: opacity 0.3s;
}

#play-button.visible {
    opacity: 1;
}

/* 声音控制按钮 */
#volume-control {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 36px;
    height: 36px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
    z-index: 20;
    cursor: pointer;
}

video::-internal-media-controls-download-button { display: none; }
video::-webkit-media-controls-enclosure { overflow: hidden; }
video::-webkit-media-controls-panel { width: calc(100% + 30px); }

/* 评论区样式 - 文字变小变细 */
.comments-container {
    position: absolute;
    left: 0;
    width: 85%;
    height: 25vh;
    z-index: 20;
    overflow: hidden;
    pointer-events: none;
    padding-left: 10px;
    box-sizing: border-box;
    /* 初始位置在广告上方 */
    bottom: 130px;
}

.comments-wrapper {
    position: absolute;
    width: 100%;
    bottom: 0;
}

.comment {
    width: fit-content;
    max-width: 90%;
    padding: 6px 12px;
    margin-bottom: 5px;
    margin-left: 5px;
    border-radius: 20px;
    background-color: rgba(0, 0, 0, 0.3);
    color: white;
    text-align: left;
    font-size: 12px;
    font-weight: 300;
    line-height: 1.4;
    opacity: 0;
    transform: translateY(15px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    word-wrap: break-word;
    white-space: normal;
}

.comment.active {
    opacity: 1;
    transform: translateY(0);
}

.comment.exit {
    opacity: 0;
    transform: translateY(-15px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
}

.comment .username {
    font-weight: 400;
    margin-right: 8px;
    color: #FFFFCC;
}

.level-icon {
    display: inline-block;
    margin-right: 5px;
    font-size: 11px;
}

/* 广告栏样式 */
.ad-banner {
    position: absolute;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    min-height: 60px;
    max-height: 200px;
    z-index: 100;
    border-radius: 10px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    pointer-events: auto !important;
    box-sizing: border-box;
    display: block !important;
    opacity: 1 !important;
}

.ad-content {
    width: 100%;
    height: 100%;
}
.ad-placement-banner-1 {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}
.ad-placement-banner-1 img {
    max-width: 100% !important;
    max-height: 180px !important;
    object-fit: contain !important;
    border-radius: 5px;
}

/* 广告关闭按钮 - 确保在最上层且可点击 */
.close-ad {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    font-size: 12px;
    cursor: pointer;
    z-index: 101;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* 底部互动区 */
.interaction-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background: linear-gradient(180deg, transparent, rgba(0,0,0,0.7));
    z-index: 25;
    display: flex;
    align-items: center;
    padding: 0 15px;
    box-sizing: border-box;
}

.danmaku-input {
    flex: 1;
    height: 36px;
    background-color: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 18px;
    padding: 0 15px;
    color: #fff;
    font-size: 14px;
    text-align: left;
}

.send-btn {
    width: 60px;
    height: 36px;
    background-color: #FE2C55;
    color: #fff;
    border: none;
    border-radius: 18px;
    font-size: 14px;
    font-weight: 500;
    margin-left: 10px;
}

/* 视频信息提示 */
.video-info {
    position: absolute;
    top: 20px;
    left: 15px;
    background-color: rgba(0,0,0,0.5);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 20;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

/* 滑动提示 */
.swipe-hint {
    position: absolute;
    top: 50%;
    left: 10px;
    color: rgba(255,255,255,0.7);
    font-size: 14px;
    z-index: 20;
    transform: translateY(-50%);
    background-color: rgba(0,0,0,0.3);
    padding: 5px 10px;
    border-radius: 20px;
}

/* 预加载视频元素 - 不可见 */
#preload-video {
    display: none;
}
</style>
</head>
<body>
    <div class="app">
        <!-- 视频加载前的占位图 -->
        <div id="video-placeholder">
            <i class="fa fa-spinner fa-spin mr-2"></i> 页面加载中...
        </div>
        
        <!-- 主视频播放器 - 默认静音 -->
        <video id="player" src="" preload muted webkit-playsinline='true' playsinline='true' x5-video-player-type='h5-page' x5-video-player-fullscreen='false' poster="https://gd-hbimg.huaban.com/dd5c3c7f9ab5aa97ff3b84852f834f47873bd2a5fee0-tBa7jJ_fw658webp"></video>
        
        <!-- 预加载视频元素 -->
        <video id="preload-video" preload="none" webkit-playsinline='true' playsinline='true'></video>
        
        <!-- 视频覆盖层 - 用于点击播放/暂停和滑动切换 -->
        <div id="video-overlay"></div>
        <div id="play-button" class="visible">
            <i class="fa fa-play"></i>
        </div>
        
        <!-- 右上角声音控制按钮 -->
        <div id="volume-control">
            <i class="fa fa-volume-off"></i>
        </div>
        
        <!-- 滑动提示 -->
        <div class="swipe-hint">
            <i class="fa fa-exchange"></i> 上下滑动切换直播
        </div>
        
        <!-- 视频信息提示 -->
        <div class="video-info">
            <i class="fa fa-info-circle"></i> 点击屏幕播放/暂停
        </div>
        
        <!-- 评论区 -->
        <div class="comments-container" id="commentsContainer">
            <div class="comments-wrapper" id="commentsWrapper"></div>
        </div>
        
        <!-- 广告栏 -->
        <div class="ad-banner" id="adBanner">
            <div class="ad-content">
                <div class="ad-placement-banner-1"></div>
                <script>
                    // 延迟加载广告避免第三方Cookie警告
                    setTimeout(() => {
                        const script = document.createElement('script');
                        script.src = 'https://adsc.144514.xyz/ad/embed?placement=banner-1';
                        document.querySelector('.ad-content').appendChild(script);
                    }, 2000);
                </script>
            </div>
            <button class="close-ad" id="closeAd">×</button>
        </div>
        
        <!-- 底部互动区 -->
        <div class="interaction-bar">
            <input type="text" class="danmaku-input" placeholder="发送弹幕...">
            <button class="send-btn">发送</button>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    // 页面完全加载后再初始化
    window.addEventListener('load', function() {
        console.log('页面加载完成，开始初始化...');
        
        // 预加载视频元素
        const preloadVideo = document.getElementById('preload-video');
        
        // 初始化视频播放器
        class VideoPlayer {
            constructor() {
                this.player = document.getElementById('player');
                this.overlay = document.getElementById('video-overlay');
                this.playButton = document.getElementById('play-button');
                this.volumeControl = document.getElementById('volume-control');
                this.videoPlaceholder = document.getElementById('video-placeholder');
                this.commentsContainer = document.getElementById('commentsContainer');
                this.currentVideoIndex = 0;
                this.startX = 0;
                this.startY = 0;
                this.endX = 0;
                this.endY = 0;
                this.swipeThreshold = 50;
                this.isPlaying = false;
                this.isMuted = true;
                this.isLoading = false;
                this.loopCurrent = true; // 默认循环播放当前视频
                
                this.initVideoEvents();
                this.setupOverlayEvents();
                this.setupPlayButton();
                this.setupVolumeControl();
                this.setupCloseAdButton();
                
                // 页面加载完成后加载第一个视频
                this.loadInitialVideo();
            }
            
            // 加载初始视频
            loadInitialVideo() {
                console.log('加载初始视频:', vdurl_arr[this.currentVideoIndex]);
                this.player.src = vdurl_arr[this.currentVideoIndex];
                this.player.load();
                
                // 预加载下一个视频
                this.preloadNextVideo();
                
                // 隐藏占位图，显示视频
                setTimeout(() => {
                    this.videoPlaceholder.style.display = 'none';
                    this.player.style.display = 'block';
                }, 500);
            }
            
            // 预加载下一个视频
            preloadNextVideo() {
                const nextIndex = (this.currentVideoIndex + 1) % vdurl_arr.length;
                console.log('预加载下一个视频:', vdurl_arr[nextIndex]);
                preloadVideo.src = vdurl_arr[nextIndex];
                preloadVideo.load();
            }
            
            setupOverlayEvents() {
                // 覆盖层点击事件 - 播放/暂停
                this.overlay.addEventListener('click', () => {
                    console.log('点击屏幕，切换播放状态');
                    this.togglePlayPause();
                });
                
                // 覆盖层触摸事件（上下滑动切换视频）
                this.overlay.addEventListener('touchstart', (e) => {
                    this.startX = e.touches[0].clientX;
                    this.startY = e.touches[0].clientY;
                });
                
                this.overlay.addEventListener('touchend', (e) => {
                    this.endX = e.changedTouches[0].clientX;
                    this.endY = e.changedTouches[0].clientY;
                    this.handleSwipe();
                });
            }
            
            setupPlayButton() {
                this.playButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    console.log('点击播放按钮，切换播放状态');
                    this.togglePlayPause();
                });
            }
            
            setupVolumeControl() {
                this.volumeControl.addEventListener('click', () => {
                    this.toggleMute();
                });
            }
            
            // 修复广告关闭按钮
            setupCloseAdButton() {
                const closeAdBtn = document.getElementById('closeAd');
                closeAdBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // 防止事件冒泡到覆盖层
                    console.log('点击关闭广告按钮');
                    const adBanner = document.getElementById('adBanner');
                    adBanner.style.display = 'none';
                    // 调整评论区位置
                    this.commentsContainer.style.bottom = '60px';
                });
            }
            
            toggleMute() {
                this.isMuted = !this.isMuted;
                this.player.muted = this.isMuted;
                
                if (this.isMuted) {
                    this.volumeControl.innerHTML = '<i class="fa fa-volume-off"></i>';
                } else {
                    this.volumeControl.innerHTML = '<i class="fa fa-volume-up"></i>';
                }
            }
            
            togglePlayPause() {
                if (this.player.paused) {
                    this.player.play().then(() => {
                        this.isPlaying = true;
                        this.playButton.classList.remove('visible');
                        console.log('视频开始播放');
                    }).catch(error => {
                        console.error('播放失败:', error);
                        layer.msg('播放失败，请点击重试');
                    });
                } else {
                    this.player.pause();
                    this.isPlaying = false;
                    this.playButton.classList.add('visible');
                    console.log('视频已暂停');
                }
            }
            
            handleSwipe() {
                const diffX = Math.abs(this.startX - this.endX);
                const diffY = this.startY - this.endY;
                
                if (Math.abs(diffY) > this.swipeThreshold && Math.abs(diffY) > diffX) {
                    if (diffY > 0) {
                        console.log('向上滑动，切换到下一个视频');
                        this.switchToNext();
                    } else {
                        console.log('向下滑动，切换到上一个视频');
                        this.switchToPrev();
                    }
                }
            }
            
            initVideoEvents() {
                this.player.addEventListener('play', () => {
                    this.isPlaying = true;
                    this.playButton.classList.remove('visible');
                });
                
                this.player.addEventListener('pause', () => {
                    this.isPlaying = false;
                    this.playButton.classList.add('visible');
                });
                
                this.player.addEventListener('waiting', () => {
                    layer.msg('视频缓冲中...');
                });
                
                this.player.addEventListener('canplay', () => {
                    // 视频可播放时隐藏提示
                });
                
                this.player.addEventListener('error', (e) => {
                    console.error('视频加载错误:', e);
                    layer.msg('视频加载失败，正在尝试切换...');
                    setTimeout(() => this.switchToNext(), 1000);
                });
                
                // 视频结束时循环播放当前视频
                this.player.addEventListener('ended', () => {
                    console.log('视频播放结束');
                    if (this.loopCurrent) {
                        console.log('循环播放当前视频');
                        this.player.currentTime = 0;
                        this.player.play();
                    } else {
                        this.switchToNext();
                    }
                });
            }
            
            async switchToNext() {
                if (this.isLoading) return;
                this.isLoading = true;
                
                try {
                    // 先尝试从接口获取新视频
                    try {
                        const newUrl = await getRandomVideoFromApi();
                        vdurl_arr.push(newUrl);
                        await this.changeVideo(vdurl_arr.length - 1);
                    } catch (err) {
                        console.log('接口获取视频失败，使用本地数组', err);
                        // 接口失败：使用本地数组切换
                        let nextIndex = (this.currentVideoIndex + 1) % vdurl_arr.length;
                        while (vdurlold.includes(vdurl_arr[nextIndex]) && vdurl_arr.length > 1) {
                            nextIndex = (nextIndex + 1) % vdurl_arr.length;
                        }
                        await this.changeVideo(nextIndex);
                    }
                } finally {
                    this.isLoading = false;
                }
            }
            
            async switchToPrev() {
                if (this.isLoading) return;
                this.isLoading = true;
                
                try {
                    // 查找上一个未播放的视频
                    let prevIndex = (this.currentVideoIndex - 1 + vdurl_arr.length) % vdurl_arr.length;
                    while (vdurlold.includes(vdurl_arr[prevIndex]) && vdurl_arr.length > 1) {
                        prevIndex = (prevIndex - 1 + vdurl_arr.length) % vdurl_arr.length;
                    }
                    await this.changeVideo(prevIndex);
                } finally {
                    this.isLoading = false;
                }
            }
            
            async changeVideo(index) {
                if (index < 0 || index >= vdurl_arr.length) return;
                
                this.player.pause();
                layer.msg('切换视频中...');
                this.playButton.innerHTML = '<i class="fa fa-spinner fa-spin"></i>';
                this.playButton.classList.add('visible');
                
                try {
                    this.currentVideoIndex = index;
                    this.player.src = vdurl_arr[index];
                    await this.player.load();
                    this.player.muted = this.isMuted;
                    
                    // 播放新视频
                    setTimeout(() => {
                        this.player.play().then(() => {
                            this.isPlaying = true;
                            this.playButton.classList.remove('visible');
                            layer.msg('视频切换成功');
                            
                            // 记录已播放视频
                            if (!vdurlold.includes(vdurl_arr[index])) {
                                vdurlold.push(vdurl_arr[index]);
                                if (vdurlold.length > 50) {
                                    vdurlold.shift();
                                }
                            }
                            
                            // 预加载下一个视频
                            this.preloadNextVideo();
                        }).catch(error => {
                            console.log('切换后播放失败:', error);
                            this.isPlaying = false;
                            this.playButton.innerHTML = '<i class="fa fa-play"></i>';
                            this.playButton.classList.add('visible');
                        });
                    }, 300);
                    
                    // 清空并重新添加评论
                    commentsWrapper.innerHTML = '';
                    for (let i = 0; i < 4; i++) {
                        setTimeout(() => addComment(), i * 400);
                    }
                } catch (error) {
                    console.error('视频切换失败:', error);
                    layer.msg('视频切换失败，请重试');
                    this.playButton.innerHTML = '<i class="fa fa-play"></i>';
                }
            }
        }

        // 视频相关变量
        let vdurlold = [];
        let vdurl_arr = [
            "https://tucdn.wpon.cn/api-girl/videos/76.mp4",
            "https://tucdn.wpon.cn/api-girl/videos/68.mp4",
            "https://tucdn.wpon.cn/api-girl/videos/54.mp4",
            "https://tucdn.wpon.cn/api-girl/videos/42.mp4",
            "https://tucdn.wpon.cn/api-girl/videos/36.mp4"
        ];
        
        let currentVideoIndex = 0;
        let videoPlayer = new VideoPlayer();
        
        // 接口请求函数
        function getRandomVideoFromApi() {
            return new Promise((resolve, reject) => {
                layer.msg('获取新视频中...');
                const timeout = setTimeout(() => {
                    reject(new Error('接口请求超时'));
                }, 5000);
                
                $.get("./get-random-url")
                    .done(function(videoUrl) {
                        clearTimeout(timeout);
                        if (videoUrl && videoUrl.trim()) {
                            if (vdurlold.includes(videoUrl.trim())) {
                                getRandomVideoFromApi().then(resolve).catch(reject);
                            } else {
                                resolve(videoUrl.trim());
                            }
                        } else {
                            reject(new Error('接口返回空地址'));
                        }
                    })
                    .fail(function(xhr, status, err) {
                        clearTimeout(timeout);
                        reject(new Error(`接口请求失败: ${status}`));
                    });
            });
        }
        
        // 评论区相关逻辑
        function generatePhoneNumber() {
            const prefix = ['130', '131', '132', '133', '134', '135', '136', '137', '138', '139', '150', '151', '152', '153', '155', '156', '157', '158', '159', '170', '171', '173', '176', '177', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189'];
            const randomPrefix = prefix[Math.floor(Math.random() * prefix.length)];
            const lastFour = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            return `${randomPrefix}****${lastFour}`;
        }
        
        function generateLetterName() {
            const letters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let name = '';
            const prefixLength = 3 + Math.floor(Math.random() * 3);
            for (let i = 0; i < prefixLength; i++) {
                name += letters.charAt(Math.floor(Math.random() * letters.length));
            }
            name += '***';
            const suffixLength = 2 + Math.floor(Math.random() * 3);
            for (let i = 0; i < suffixLength; i++) {
                name += letters.charAt(Math.floor(Math.random() * letters.length));
            }
            return name;
        }
        
        function generateUsername() {
            return Math.random() > 0.5 ? generatePhoneNumber() : generateLetterName();
        }
        
        const levelIcons = [
            { icon: 'fa-diamond', color: '#FFD700' },
            { icon: 'fa-crown', color: '#FFA500' },
            { icon: 'fa-star', color: '#FFFF00' },
            { icon: 'fa-moon-o', color: '#87CEFA' },
            { icon: 'fa-sun-o', color: '#FF6347' },
            { icon: 'fa-shield', color: '#32CD32' },
            { icon: 'fa-heart', color: '#FF69B4' },
            { icon: 'fa-trophy', color: '#CD7F32' }
        ];
        
        function getRandomLevelIcon() {
            const level = levelIcons[Math.floor(Math.random() * levelIcons.length)];
            return `<i class="fa ${level.icon} level-icon" style="color: ${level.color}"></i>`;
        }
        
        const commentsContent = [
            "这个主播太有意思了",
            "刚来，这是在聊什么呀？",
            "前排围观",
            "主播声音好好听",
            "支持支持！",
            "哈哈哈太搞笑了",
            "下班刚到家就来看直播了",
            "有没有同款手机壳？",
            "看起来好好吃的样子",
            "这个地方我去过！真的很不错"
        ];
        
        function generateRandomComment() {
            return {
                username: generateUsername(),
                content: commentsContent[Math.floor(Math.random() * commentsContent.length)]
            };
        }

        const commentsWrapper = document.getElementById('commentsWrapper');
        
        function addComment() {
            const comment = generateRandomComment();
            const levelIcon = getRandomLevelIcon();
            
            const commentEl = document.createElement('div');
            commentEl.className = 'comment';
            commentEl.innerHTML = `${levelIcon}<span class="username">${comment.username}</span>${comment.content}`;
            
            commentsWrapper.appendChild(commentEl);
            
            setTimeout(() => {
                commentEl.classList.add('active');
            }, 50);
            
            const allComments = commentsWrapper.querySelectorAll('.comment');
            if (allComments.length > 4) {
                const oldestComment = allComments[0];
                oldestComment.classList.remove('active');
                oldestComment.classList.add('exit');
                
                setTimeout(() => {
                    if (oldestComment.parentNode === commentsWrapper) {
                        commentsWrapper.removeChild(oldestComment);
                    }
                }, 800);
            }
        }
        
        function scheduleNextComment() {
            const randomDelay = 1000 + Math.random() * 2000;
            setTimeout(() => {
                addComment();
                scheduleNextComment();
            }, randomDelay);
        }
        
        // 页面加载完成后再开始评论生成
        setTimeout(() => {
            for (let i = 0; i < 4; i++) {
                setTimeout(() => addComment(), i * 600);
            }
            scheduleNextComment();
        }, 1000);
        
        // 发送弹幕功能
        const sendBtn = document.querySelector('.send-btn');
        const danmakuInput = document.querySelector('.danmaku-input');
        
        sendBtn.addEventListener('click', function() {
            const text = danmakuInput.value.trim();
            if (text) {
                const commentEl = document.createElement('div');
                commentEl.className = 'comment';
                commentEl.innerHTML = `<i class="fa fa-user level-icon" style="color: #FFFFFF"></i><span class="username">我</span>${text}`;
                
                commentsWrapper.appendChild(commentEl);
                setTimeout(() => {
                    commentEl.classList.add('active');
                }, 50);
                
                const allComments = commentsWrapper.querySelectorAll('.comment');
                if (allComments.length > 4) {
                    const oldestComment = allComments[0];
                    oldestComment.classList.remove('active');
                    oldestComment.classList.add('exit');
                    
                    setTimeout(() => {
                        commentsWrapper.removeChild(oldestComment);
                    }, 800);
                }
                
                danmakuInput.value = '';
            }
        });
        
        danmakuInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                sendBtn.click();
            }
        });
        
        // 广告加载检测
        setTimeout(() => {
            const adBanner = document.getElementById('adBanner');
            if (adBanner.offsetHeight < 50) {
                console.log('广告加载异常，尝试重新加载');
                const adScript = document.createElement('script');
                adScript.src = 'https://adsc.144514.xyz/ad/embed?placement=banner-1';
                document.querySelector('.ad-content').appendChild(adScript);
            }
        }, 3000);
    });
    </script>
</body>
</html>
    
